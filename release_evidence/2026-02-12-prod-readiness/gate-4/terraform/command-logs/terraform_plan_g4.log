[UTC] 2026-02-15T16:23:56Z
[CMD] terraform -chdir="/Users/ethanurbanski/arco/.worktrees/codex-prod-go-closure-batch3/infra/terraform" plan -var-file=environments/staging.tfvars -lock=false -input=false -no-color -out="/Users/ethanurbanski/arco/.worktrees/codex-prod-go-closure-batch3/release_evidence/2026-02-12-prod-readiness/gate-4/terraform/staging.tfplan"
data.google_project.current: Reading...

Terraform used the selected providers to generate the following execution
plan. Resource actions are indicated with the following symbols:
  + create

Terraform planned the following actions, but then encountered a problem:

  # google_cloud_run_v2_job.compactor_antientropy will be created
  + resource "google_cloud_run_v2_job" "compactor_antientropy" {
      + conditions               = (known after apply)
      + create_time              = (known after apply)
      + creator                  = (known after apply)
      + delete_time              = (known after apply)
      + deletion_protection      = true
      + effective_annotations    = (known after apply)
      + effective_labels         = {
          + "goog-terraform-provisioned" = "true"
        }
      + etag                     = (known after apply)
      + execution_count          = (known after apply)
      + expire_time              = (known after apply)
      + generation               = (known after apply)
      + id                       = (known after apply)
      + last_modifier            = (known after apply)
      + latest_created_execution = (known after apply)
      + launch_stage             = (known after apply)
      + location                 = "us-central1"
      + name                     = "arco-compactor-antientropy-staging"
      + observed_generation      = (known after apply)
      + project                  = "dataverse-dev-471815"
      + reconciling              = (known after apply)
      + terminal_condition       = (known after apply)
      + terraform_labels         = {
          + "goog-terraform-provisioned" = "true"
        }
      + uid                      = (known after apply)
      + update_time              = (known after apply)

      + template {
          + parallelism = (known after apply)
          + task_count  = (known after apply)

          + template {
              + execution_environment = (known after apply)
              + max_retries           = 3
              + service_account       = "[REDACTED_EMAIL]"
              + timeout               = (known after apply)

              + containers {
                  + args  = [
                      + "anti-entropy",
                      + "--tenant-id",
                      + "staging",
                      + "--workspace-id",
                      + "staging",
                      + "--storage-bucket",
                      + "dataverse-dev-471815-arco-catalog-staging",
                      + "--domain",
                      + "catalog",
                      + "--max-objects-per-run",
                      + "1000",
                    ]
                  + image = "us-central1-docker.pkg.dev/dataverse-dev-471815/arco/arco-compactor:staging"

                  + env {
                      + name  = "ARCO_COMPACTOR_AUDIENCE"
                      + value = (known after apply)
                    }
                  + env {
                      + name  = "ARCO_COMPACTOR_URL"
                      + value = (known after apply)
                    }
                  + env {
                      + name  = "ARCO_ENVIRONMENT"
                      + value = "staging"
                    }
                  + env {
                      + name  = "ARCO_STORAGE_BUCKET"
                      + value = "dataverse-dev-471815-arco-catalog-staging"
                    }

                  + resources (known after apply)

                  + startup_probe (known after apply)
                }
            }
        }
    }

  # google_cloud_run_v2_job_iam_member.compactor_antientropy_invoker will be created
  + resource "google_cloud_run_v2_job_iam_member" "compactor_antientropy_invoker" {
      + etag     = (known after apply)
      + id       = (known after apply)
      + location = "us-central1"
      + member   = "serviceAccount:[REDACTED_EMAIL]"
      + name     = "arco-compactor-antientropy-staging"
      + project  = "dataverse-dev-471815"
      + role     = "roles/run.invoker"
    }

  # google_cloud_run_v2_service.api will be created
  + resource "google_cloud_run_v2_service" "api" {
      + conditions              = (known after apply)
      + create_time             = (known after apply)
      + creator                 = (known after apply)
      + delete_time             = (known after apply)
      + deletion_protection     = true
      + effective_annotations   = (known after apply)
      + effective_labels        = {
          + "goog-terraform-provisioned" = "true"
        }
      + etag                    = (known after apply)
      + expire_time             = (known after apply)
      + generation              = (known after apply)
      + id                      = (known after apply)
      + ingress                 = "INGRESS_TRAFFIC_INTERNAL_ONLY"
      + last_modifier           = (known after apply)
      + latest_created_revision = (known after apply)
      + latest_ready_revision   = (known after apply)
      + launch_stage            = (known after apply)
      + location                = "us-central1"
      + name                    = "arco-api-staging"
      + observed_generation     = (known after apply)
      + project                 = "dataverse-dev-471815"
      + reconciling             = (known after apply)
      + terminal_condition      = (known after apply)
      + terraform_labels        = {
          + "goog-terraform-provisioned" = "true"
        }
      + traffic_statuses        = (known after apply)
      + uid                     = (known after apply)
      + update_time             = (known after apply)
      + uri                     = (known after apply)
      + urls                    = (known after apply)

      + scaling (known after apply)

      + template {
          + max_instance_request_concurrency = (known after apply)
          + service_account                  = "[REDACTED_EMAIL]"
          + timeout                          = (known after apply)

          + containers {
              + build_info = (known after apply)
              + image      = "us-central1-docker.pkg.dev/dataverse-dev-471815/arco/arco-api:staging"

              + env {
                  + name  = "ARCO_API_PUBLIC"
                  + value = "false"
                }
              + env {
                  + name  = "ARCO_CODE_VERSION"
                  + value = "2026-02-12-prod-readiness"
                }
              + env {
                  + name  = "ARCO_CORS_ALLOWED_ORIGINS"
                  + value = "https://staging.arco.example.com"
                }
              + env {
                  + name  = "ARCO_DEBUG"
                  + value = "false"
                }
              + env {
                  + name  = "ARCO_ENVIRONMENT"
                  + value = "staging"
                }
              + env {
                  + name  = "ARCO_GRPC_PORT"
                  + value = "9090"
                }
              + env {
                  + name  = "ARCO_HTTP_PORT"
                  + value = "8080"
                }
              + env {
                  + name  = "ARCO_JWT_AUDIENCE"
                  + value = "arco-staging"
                }
              + env {
                  + name  = "ARCO_JWT_ISSUER"
                  + value = "https://issuer.example.com/staging"
                }
              + env {
                  + name  = "ARCO_JWT_SECRET"
                    # (1 unchanged attribute hidden)

                  + value_source {
                      + secret_key_ref {
                          + secret  = "arco-jwt-secret-staging"
                          + version = "latest"
                        }
                    }
                }
              + env {
                  + name  = "ARCO_STORAGE_BUCKET"
                  + value = "dataverse-dev-471815-arco-catalog-staging"
                }

              + liveness_probe {
                  + failure_threshold     = 3
                  + initial_delay_seconds = 0
                  + period_seconds        = 30
                  + timeout_seconds       = 5

                  + http_get {
                      + path = "/health"
                      + port = 8080
                    }
                }

              + ports {
                  + container_port = 8080
                  + name           = "http1"
                }

              + resources {
                  + cpu_idle          = true
                  + limits            = {
                      + "cpu"    = "2"
                      + "memory" = "1Gi"
                    }
                  + startup_cpu_boost = true
                }

              + startup_probe {
                  + failure_threshold     = 3
                  + initial_delay_seconds = 2
                  + period_seconds        = 5
                  + timeout_seconds       = 5

                  + http_get {
                      + path = "/ready"
                      + port = 8080
                    }
                }
            }

          + scaling {
              + max_instance_count = 5
              + min_instance_count = 1
            }
        }

      + traffic {
          + percent = 100
          + type    = "TRAFFIC_TARGET_ALLOCATION_TYPE_LATEST"
        }
    }

  # google_cloud_run_v2_service.compactor will be created
  + resource "google_cloud_run_v2_service" "compactor" {
      + conditions              = (known after apply)
      + create_time             = (known after apply)
      + creator                 = (known after apply)
      + delete_time             = (known after apply)
      + deletion_protection     = true
      + effective_annotations   = (known after apply)
      + effective_labels        = {
          + "goog-terraform-provisioned" = "true"
        }
      + etag                    = (known after apply)
      + expire_time             = (known after apply)
      + generation              = (known after apply)
      + id                      = (known after apply)
      + ingress                 = "INGRESS_TRAFFIC_INTERNAL_ONLY"
      + last_modifier           = (known after apply)
      + latest_created_revision = (known after apply)
      + latest_ready_revision   = (known after apply)
      + launch_stage            = (known after apply)
      + location                = "us-central1"
      + name                    = "arco-compactor-staging"
      + observed_generation     = (known after apply)
      + project                 = "dataverse-dev-471815"
      + reconciling             = (known after apply)
      + terminal_condition      = (known after apply)
      + terraform_labels        = {
          + "goog-terraform-provisioned" = "true"
        }
      + traffic_statuses        = (known after apply)
      + uid                     = (known after apply)
      + update_time             = (known after apply)
      + uri                     = (known after apply)
      + urls                    = (known after apply)

      + scaling (known after apply)

      + template {
          + max_instance_request_concurrency = (known after apply)
          + service_account                  = "[REDACTED_EMAIL]"
          + timeout                          = (known after apply)

          + containers {
              + build_info = (known after apply)
              + image      = "us-central1-docker.pkg.dev/dataverse-dev-471815/arco/arco-compactor:staging"

              + env {
                  + name  = "ARCO_COMPACTOR_GC_ENABLED"
                  + value = "true"
                }
              + env {
                  + name  = "ARCO_COMPACTOR_GC_RETENTION_DAYS"
                  + value = "7"
                }
              + env {
                  + name  = "ARCO_COMPACTOR_INTERVAL_SECS"
                  + value = "30"
                }
              + env {
                  + name  = "ARCO_COMPACTOR_PORT"
                  + value = "8081"
                }
              + env {
                  + name  = "ARCO_ENVIRONMENT"
                  + value = "staging"
                }
              + env {
                  + name  = "ARCO_STORAGE_BUCKET"
                  + value = "dataverse-dev-471815-arco-catalog-staging"
                }

              + liveness_probe {
                  + failure_threshold     = 3
                  + initial_delay_seconds = 0
                  + period_seconds        = 60
                  + timeout_seconds       = 10

                  + http_get {
                      + path = "/health"
                      + port = 8081
                    }
                }

              + ports {
                  + container_port = 8081
                  + name           = "http1"
                }

              + resources {
                  + cpu_idle          = false
                  + limits            = {
                      + "cpu"    = "2"
                      + "memory" = "2Gi"
                    }
                  + startup_cpu_boost = true
                }

              + startup_probe {
                  + failure_threshold     = 6
                  + initial_delay_seconds = 5
                  + period_seconds        = 10
                  + timeout_seconds       = 10

                  + http_get {
                      + path = "/health"
                      + port = 8081
                    }
                }
            }

          + scaling {
              + max_instance_count = 2
              + min_instance_count = 1
            }
        }

      + traffic {
          + percent = 100
          + type    = "TRAFFIC_TARGET_ALLOCATION_TYPE_LATEST"
        }
    }

  # google_cloud_run_v2_service_iam_member.compactor_antientropy_invoker[0] will be created
  + resource "google_cloud_run_v2_service_iam_member" "compactor_antientropy_invoker" {
      + etag     = (known after apply)
      + id       = (known after apply)
      + location = "us-central1"
      + member   = "serviceAccount:[REDACTED_EMAIL]"
      + name     = "arco-compactor-staging"
      + project  = "dataverse-dev-471815"
      + role     = "roles/run.invoker"
    }

  # google_cloud_run_v2_service_iam_member.invoker_compactor[0] will be created
  + resource "google_cloud_run_v2_service_iam_member" "invoker_compactor" {
      + etag     = (known after apply)
      + id       = (known after apply)
      + location = "us-central1"
      + member   = "serviceAccount:[REDACTED_EMAIL]"
      + name     = "arco-compactor-staging"
      + project  = "dataverse-dev-471815"
      + role     = "roles/run.invoker"
    }

  # google_cloud_run_v2_service_iam_member.invoker_dispatcher[0] will be created
  + resource "google_cloud_run_v2_service_iam_member" "invoker_dispatcher" {
      + etag     = (known after apply)
      + id       = (known after apply)
      + location = "us-central1"
      + member   = "serviceAccount:[REDACTED_EMAIL]"
      + name     = "arco-flow-dispatcher-staging"
      + project  = "dataverse-dev-471815"
      + role     = "roles/run.invoker"
    }

  # google_cloud_scheduler_job.compactor_antientropy_trigger will be created
  + resource "google_cloud_scheduler_job" "compactor_antientropy_trigger" {
      + description = "Triggers Arco compactor anti-entropy job periodically"
      + id          = (known after apply)
      + name        = "arco-compactor-antientropy-trigger-staging"
      + paused      = (known after apply)
      + project     = "dataverse-dev-471815"
      + region      = "us-central1"
      + schedule    = "*/15 * * * *"
      + state       = (known after apply)
      + time_zone   = "Etc/UTC"

      + http_target {
          + http_method = "POST"
          + uri         = "https://us-central1-run.googleapis.com/apis/run.googleapis.com/v1/namespaces/dataverse-dev-471815/jobs/arco-compactor-antientropy-staging:run"

          + oauth_token {
              + service_account_email = "[REDACTED_EMAIL]"
            }
        }

      + retry_config {
          + max_backoff_duration = (known after apply)
          + max_doublings        = (known after apply)
          + max_retry_duration   = (known after apply)
          + min_backoff_duration = (known after apply)
          + retry_count          = 3
        }
    }

  # google_cloud_tasks_queue.flow_dispatch will be created
  + resource "google_cloud_tasks_queue" "flow_dispatch" {
      + desired_state = "RUNNING"
      + id            = (known after apply)
      + location      = "us-central1"
      + name          = "arco-flow-dispatch-staging"
      + project       = "dataverse-dev-471815"
      + state         = (known after apply)

      + rate_limits {
          + max_burst_size            = (known after apply)
          + max_concurrent_dispatches = 500
          + max_dispatches_per_second = 50
        }

      + retry_config {
          + max_attempts       = 5
          + max_backoff        = "300s"
          + max_doublings      = (known after apply)
          + max_retry_duration = "3600s"
          + min_backoff        = "10s"
        }

      + stackdriver_logging_config {
          + sampling_ratio = 1
        }
    }

  # google_cloud_tasks_queue.flow_timer will be created
  + resource "google_cloud_tasks_queue" "flow_timer" {
      + desired_state = "RUNNING"
      + id            = (known after apply)
      + location      = "us-central1"
      + name          = "arco-flow-timers-staging"
      + project       = "dataverse-dev-471815"
      + state         = (known after apply)

      + rate_limits {
          + max_burst_size            = (known after apply)
          + max_concurrent_dispatches = 500
          + max_dispatches_per_second = 50
        }

      + retry_config {
          + max_attempts       = 5
          + max_backoff        = "300s"
          + max_doublings      = (known after apply)
          + max_retry_duration = "3600s"
          + min_backoff        = "10s"
        }

      + stackdriver_logging_config {
          + sampling_ratio = 1
        }
    }

  # google_project_iam_custom_role.storage_object_reader_no_list will be created
  + resource "google_project_iam_custom_role" "storage_object_reader_no_list" {
      + deleted     = (known after apply)
      + description = "Read individual objects without list capability"
      + id          = (known after apply)
      + name        = (known after apply)
      + permissions = [
          + "storage.objects.get",
        ]
      + project     = "dataverse-dev-471815"
      + role_id     = "storageObjectReaderNoList"
      + stage       = "GA"
      + title       = "Storage Object Reader (No List)"
    }

  # google_project_iam_member.api_cloud_tasks_enqueuer will be created
  + resource "google_project_iam_member" "api_cloud_tasks_enqueuer" {
      + etag    = (known after apply)
      + id      = (known after apply)
      + member  = "serviceAccount:[REDACTED_EMAIL]"
      + project = "dataverse-dev-471815"
      + role    = "roles/cloudtasks.enqueuer"
    }

  # google_secret_manager_secret.jwt_secret[0] will be created
  + resource "google_secret_manager_secret" "jwt_secret" {
      + create_time           = (known after apply)
      + deletion_protection   = false
      + effective_annotations = (known after apply)
      + effective_labels      = {
          + "environment"                = "staging"
          + "goog-terraform-provisioned" = "true"
          + "service"                    = "arco"
        }
      + expire_time           = (known after apply)
      + id                    = (known after apply)
      + labels                = {
          + "environment" = "staging"
          + "service"     = "arco"
        }
      + name                  = (known after apply)
      + project               = "dataverse-dev-471815"
      + secret_id             = "arco-jwt-secret-staging"
      + terraform_labels      = {
          + "environment"                = "staging"
          + "goog-terraform-provisioned" = "true"
          + "service"                    = "arco"
        }

      + replication {
          + auto {
            }
        }
    }

  # google_secret_manager_secret_iam_member.api_jwt_secret[0] will be created
  + resource "google_secret_manager_secret_iam_member" "api_jwt_secret" {
      + etag      = (known after apply)
      + id        = (known after apply)
      + member    = "serviceAccount:[REDACTED_EMAIL]"
      + project   = "dataverse-dev-471815"
      + role      = "roles/secretmanager.secretAccessor"
      + secret_id = "arco-jwt-secret-staging"
    }

  # google_service_account.api will be created
  + resource "google_service_account" "api" {
      + account_id   = "arco-api-staging"
      + description  = "Service account for Arco API - handles DDL, reads, signed URLs"
      + disabled     = false
      + display_name = "Arco API Service (staging)"
      + email        = "[REDACTED_EMAIL]"
      + id           = (known after apply)
      + member       = "serviceAccount:[REDACTED_EMAIL]"
      + name         = (known after apply)
      + project      = "dataverse-dev-471815"
      + unique_id    = (known after apply)
    }

  # google_service_account.compactor will be created
  + resource "google_service_account" "compactor" {
      + account_id   = "arco-compactor-staging"
      + description  = "Fast-path compactor - sole writer of Parquet state, NO list permission"
      + disabled     = false
      + display_name = "Arco Compactor Fast-Path (staging)"
      + email        = "[REDACTED_EMAIL]"
      + id           = (known after apply)
      + member       = "serviceAccount:[REDACTED_EMAIL]"
      + name         = (known after apply)
      + project      = "dataverse-dev-471815"
      + unique_id    = (known after apply)
    }

  # google_service_account.compactor_antientropy will be created
  + resource "google_service_account" "compactor_antientropy" {
      + account_id   = "arco-compactor-ae-staging"
      + description  = "Anti-entropy job - can list ledger/ to discover missed events"
      + disabled     = false
      + display_name = "Arco Compactor Anti-Entropy (staging)"
      + email        = "[REDACTED_EMAIL]"
      + id           = (known after apply)
      + member       = "serviceAccount:[REDACTED_EMAIL]"
      + name         = (known after apply)
      + project      = "dataverse-dev-471815"
      + unique_id    = (known after apply)
    }

  # google_service_account.invoker will be created
  + resource "google_service_account" "invoker" {
      + account_id   = "arco-invoker-staging"
      + description  = "Service account for invoking Arco services (Cloud Scheduler, Pub/Sub)"
      + disabled     = false
      + display_name = "Arco Service Invoker (staging)"
      + email        = "[REDACTED_EMAIL]"
      + id           = (known after apply)
      + member       = "serviceAccount:[REDACTED_EMAIL]"
      + name         = (known after apply)
      + project      = "dataverse-dev-471815"
      + unique_id    = (known after apply)
    }

  # google_service_account_iam_member.api_can_act_as_invoker_for_cloud_tasks_oidc will be created
  + resource "google_service_account_iam_member" "api_can_act_as_invoker_for_cloud_tasks_oidc" {
      + etag               = (known after apply)
      + id                 = (known after apply)
      + member             = "serviceAccount:[REDACTED_EMAIL]"
      + role               = "roles/iam.serviceAccountUser"
      + service_account_id = (known after apply)
    }

  # google_storage_bucket.catalog will be created
  + resource "google_storage_bucket" "catalog" {
      + effective_labels            = {
          + "component"                  = "catalog"
          + "environment"                = "staging"
          + "goog-terraform-provisioned" = "true"
          + "service"                    = "arco"
        }
      + force_destroy               = true
      + id                          = (known after apply)
      + labels                      = {
          + "component"   = "catalog"
          + "environment" = "staging"
          + "service"     = "arco"
        }
      + location                    = "US-CENTRAL1"
      + name                        = "dataverse-dev-471815-arco-catalog-staging"
      + project                     = "dataverse-dev-471815"
      + project_number              = (known after apply)
      + public_access_prevention    = "enforced"
      + rpo                         = (known after apply)
      + self_link                   = (known after apply)
      + storage_class               = "STANDARD"
      + terraform_labels            = {
          + "component"                  = "catalog"
          + "environment"                = "staging"
          + "goog-terraform-provisioned" = "true"
          + "service"                    = "arco"
        }
      + time_created                = (known after apply)
      + uniform_bucket_level_access = true
      + updated                     = (known after apply)
      + url                         = (known after apply)

      + lifecycle_rule {
          + action {
              + storage_class = "NEARLINE"
              + type          = "SetStorageClass"
            }
          + condition {
              + age                    = 30
              + matches_prefix         = []
              + matches_storage_class  = []
              + matches_suffix         = []
              + with_state             = (known after apply)
                # (3 unchanged attributes hidden)
            }
        }
      + lifecycle_rule {
          + action {
              + type          = "Delete"
                # (1 unchanged attribute hidden)
            }
          + condition {
              + age                    = 90
              + matches_prefix         = []
              + matches_storage_class  = []
              + matches_suffix         = []
              + num_newer_versions     = 3
              + with_state             = "ARCHIVED"
                # (3 unchanged attributes hidden)
            }
        }

      + soft_delete_policy (known after apply)

      + versioning {
          + enabled = true
        }

      + website (known after apply)
    }

  # google_storage_bucket_iam_member.api_read_all will be created
  + resource "google_storage_bucket_iam_member" "api_read_all" {
      + bucket = "dataverse-dev-471815-arco-catalog-staging"
      + etag   = (known after apply)
      + id     = (known after apply)
      + member = "serviceAccount:[REDACTED_EMAIL]"
      + role   = "roles/storage.objectViewer"
    }

  # google_storage_bucket_iam_member.api_write_commits will be created
  + resource "google_storage_bucket_iam_member" "api_write_commits" {
      + bucket = "dataverse-dev-471815-arco-catalog-staging"
      + etag   = (known after apply)
      + id     = (known after apply)
      + member = "serviceAccount:[REDACTED_EMAIL]"
      + role   = "roles/storage.objectCreator"

      + condition {
          + description = "Gate 5: API can create commit records (immutable)"
          + expression  = <<-EOT
                resource.name.matches("^projects/_/buckets/dataverse-dev-471815-arco-catalog-staging/objects/tenant=[^/]+/workspace=[^/]+/commits/")
            EOT
          + title       = "ApiWriteCommits"
        }
    }

  # google_storage_bucket_iam_member.api_write_ledger will be created
  + resource "google_storage_bucket_iam_member" "api_write_ledger" {
      + bucket = "dataverse-dev-471815-arco-catalog-staging"
      + etag   = (known after apply)
      + id     = (known after apply)
      + member = "serviceAccount:[REDACTED_EMAIL]"
      + role   = "roles/storage.objectCreator"

      + condition {
          + description = "Gate 5: API can create ledger events (immutable)"
          + expression  = <<-EOT
                resource.name.matches("^projects/_/buckets/dataverse-dev-471815-arco-catalog-staging/objects/tenant=[^/]+/workspace=[^/]+/ledger/")
            EOT
          + title       = "ApiWriteLedger"
        }
    }

  # google_storage_bucket_iam_member.api_write_locks will be created
  + resource "google_storage_bucket_iam_member" "api_write_locks" {
      + bucket = "dataverse-dev-471815-arco-catalog-staging"
      + etag   = (known after apply)
      + id     = (known after apply)
      + member = "serviceAccount:[REDACTED_EMAIL]"
      + role   = "roles/storage.objectUser"

      + condition {
          + description = "Gate 5: API can manage distributed locks"
          + expression  = <<-EOT
                resource.name.matches("^projects/_/buckets/dataverse-dev-471815-arco-catalog-staging/objects/tenant=[^/]+/workspace=[^/]+/locks/")
            EOT
          + title       = "ApiWriteLocks"
        }
    }

  # google_storage_bucket_iam_member.compactor_antientropy_list_ledger will be created
  + resource "google_storage_bucket_iam_member" "compactor_antientropy_list_ledger" {
      + bucket = "dataverse-dev-471815-arco-catalog-staging"
      + etag   = (known after apply)
      + id     = (known after apply)
      + member = "serviceAccount:[REDACTED_EMAIL]"
      + role   = "roles/storage.objectViewer"

      + condition {
          + description = "Gate 5: Anti-entropy can list ledger/ to find missed events"
          + expression  = <<-EOT
                resource.name.matches("^projects/_/buckets/dataverse-dev-471815-arco-catalog-staging/objects/tenant=[^/]+/workspace=[^/]+/ledger/")
            EOT
          + title       = "CompactorAntiEntropyListLedger"
        }
    }

  # google_storage_bucket_iam_member.compactor_antientropy_read_all will be created
  + resource "google_storage_bucket_iam_member" "compactor_antientropy_read_all" {
      + bucket = "dataverse-dev-471815-arco-catalog-staging"
      + etag   = (known after apply)
      + id     = (known after apply)
      + member = "serviceAccount:[REDACTED_EMAIL]"
      + role   = (known after apply)
    }

  # google_storage_bucket_iam_member.compactor_antientropy_write_cursor will be created
  + resource "google_storage_bucket_iam_member" "compactor_antientropy_write_cursor" {
      + bucket = "dataverse-dev-471815-arco-catalog-staging"
      + etag   = (known after apply)
      + id     = (known after apply)
      + member = "serviceAccount:[REDACTED_EMAIL]"
      + role   = "roles/storage.objectUser"

      + condition {
          + description = "Gate 5: Anti-entropy can update state/anti_entropy cursor"
          + expression  = <<-EOT
                resource.name.matches("^projects/_/buckets/dataverse-dev-471815-arco-catalog-staging/objects/tenant=[^/]+/workspace=[^/]+/state/anti_entropy/")
            EOT
          + title       = "CompactorAntiEntropyWriteCursor"
        }
    }

  # google_storage_bucket_iam_member.compactor_fastpath_read_objects will be created
  + resource "google_storage_bucket_iam_member" "compactor_fastpath_read_objects" {
      + bucket = "dataverse-dev-471815-arco-catalog-staging"
      + etag   = (known after apply)
      + id     = (known after apply)
      + member = "serviceAccount:[REDACTED_EMAIL]"
      + role   = (known after apply)

      + condition {
          + description = "Gate 5: Fast-path compactor can read ledger/manifests/state/snapshots/l0"
          + expression  = <<-EOT
                resource.name.matches("^projects/_/buckets/dataverse-dev-471815-arco-catalog-staging/objects/tenant=[^/]+/workspace=[^/]+/ledger/") ||
                resource.name.matches("^projects/_/buckets/dataverse-dev-471815-arco-catalog-staging/objects/tenant=[^/]+/workspace=[^/]+/manifests/") ||
                resource.name.matches("^projects/_/buckets/dataverse-dev-471815-arco-catalog-staging/objects/tenant=[^/]+/workspace=[^/]+/snapshots/") ||
                resource.name.matches("^projects/_/buckets/dataverse-dev-471815-arco-catalog-staging/objects/tenant=[^/]+/workspace=[^/]+/state/") ||
                resource.name.matches("^projects/_/buckets/dataverse-dev-471815-arco-catalog-staging/objects/tenant=[^/]+/workspace=[^/]+/l0/")
            EOT
          + title       = "CompactorFastpathReadObjects"
        }
    }

  # google_storage_bucket_iam_member.compactor_write_l0 will be created
  + resource "google_storage_bucket_iam_member" "compactor_write_l0" {
      + bucket = "dataverse-dev-471815-arco-catalog-staging"
      + etag   = (known after apply)
      + id     = (known after apply)
      + member = "serviceAccount:[REDACTED_EMAIL]"
      + role   = "roles/storage.objectUser"

      + condition {
          + description = "Gate 5: Fast-path compactor can write l0/ tier"
          + expression  = <<-EOT
                resource.name.matches("^projects/_/buckets/dataverse-dev-471815-arco-catalog-staging/objects/tenant=[^/]+/workspace=[^/]+/l0/")
            EOT
          + title       = "CompactorFastpathWriteL0"
        }
    }

  # google_storage_bucket_iam_member.compactor_write_manifests will be created
  + resource "google_storage_bucket_iam_member" "compactor_write_manifests" {
      + bucket = "dataverse-dev-471815-arco-catalog-staging"
      + etag   = (known after apply)
      + id     = (known after apply)
      + member = "serviceAccount:[REDACTED_EMAIL]"
      + role   = "roles/storage.objectUser"

      + condition {
          + description = "Gate 5: Fast-path compactor can update manifests"
          + expression  = <<-EOT
                resource.name.matches("^projects/_/buckets/dataverse-dev-471815-arco-catalog-staging/objects/tenant=[^/]+/workspace=[^/]+/manifests/")
            EOT
          + title       = "CompactorFastpathWriteManifests"
        }
    }

  # google_storage_bucket_iam_member.compactor_write_snapshots will be created
  + resource "google_storage_bucket_iam_member" "compactor_write_snapshots" {
      + bucket = "dataverse-dev-471815-arco-catalog-staging"
      + etag   = (known after apply)
      + id     = (known after apply)
      + member = "serviceAccount:[REDACTED_EMAIL]"
      + role   = "roles/storage.objectCreator"

      + condition {
          + description = "Gate 5: Fast-path compactor can write snapshots/ (Tier-1 Parquet)"
          + expression  = <<-EOT
                resource.name.matches("^projects/_/buckets/dataverse-dev-471815-arco-catalog-staging/objects/tenant=[^/]+/workspace=[^/]+/snapshots/")
            EOT
          + title       = "CompactorFastpathWriteSnapshots"
        }
    }

  # google_storage_bucket_iam_member.compactor_write_state will be created
  + resource "google_storage_bucket_iam_member" "compactor_write_state" {
      + bucket = "dataverse-dev-471815-arco-catalog-staging"
      + etag   = (known after apply)
      + id     = (known after apply)
      + member = "serviceAccount:[REDACTED_EMAIL]"
      + role   = "roles/storage.objectCreator"

      + condition {
          + description = "Gate 5: Fast-path compactor can write state/ (Parquet snapshots)"
          + expression  = <<-EOT
                resource.name.matches("^projects/_/buckets/dataverse-dev-471815-arco-catalog-staging/objects/tenant=[^/]+/workspace=[^/]+/state/")
            EOT
          + title       = "CompactorFastpathWriteState"
        }
    }

Plan: 32 to add, 0 to change, 0 to destroy.

Changes to Outputs:
  + api_service_account_email                   = "[REDACTED_EMAIL]"
  + api_service_name                            = "arco-api-staging"
  + api_url                                     = (known after apply)
  + catalog_bucket                              = "dataverse-dev-471815-arco-catalog-staging"
  + compactor_antientropy_service_account_email = "[REDACTED_EMAIL]"
  + compactor_service_account_email             = "[REDACTED_EMAIL]"
  + compactor_service_name                      = "arco-compactor-staging"
  + compactor_url                               = (known after apply)
  + environment                                 = "staging"
  + flow_dispatch_queue_name                    = "arco-flow-dispatch-staging"
  + flow_timer_queue_name                       = "arco-flow-timers-staging"
  + invoker_service_account_email               = "[REDACTED_EMAIL]"
  + region                                      = "us-central1"

Error: Error when reading or editing Project "dataverse-dev-471815": Get "https://cloudresourcemanager.googleapis.com/v1/projects/dataverse-dev-471815?alt=json&prettyPrint=false": oauth2: "invalid_grant" "reauth related error (invalid_rapt)" "https://support.google.com/a/answer/9368756"

  with data.google_project.current,
  on cloud_tasks.tf line 12, in data "google_project" "current":
  12: data "google_project" "current" {

[EXIT] 1
